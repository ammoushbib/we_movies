<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>{% block title %}We Movies {% endblock %}</title>
    <link rel="icon"
          href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 128 128%22><text y=%221.2em%22 font-size=%2296%22>⚫️</text></svg>">
    {# Run `composer require symfony/webpack-encore-bundle` to start using Symfony UX #}
    <link rel="stylesheet" href="{{ asset('css/style.css') }}">
    <link rel="stylesheet" href="{{ asset('css/navbar.css') }}">
    <link rel="stylesheet" href="{{ asset('css/modal.css') }}">
    {% block stylesheets %}
        {{ encore_entry_link_tags('app') }}
    {% endblock %}

    {% block javascripts %}
        {{ encore_entry_script_tags('app') }}
    {% endblock %}
</head>
<body>
<header>
    <h1>
        <a href="{{ path('app_home') }}">
            We Movies
        </a>
    </h1>
    <nav>
        <ul>
            <li>
                <div class="search-panel">
                    <input type="text" id="search-input" placeholder="Search for movies...">
                    <button id="clear-search" style="display: none;">&times;</button>
                    <ul id="search-results"></ul>
                </div>
                {#                        <form method="get" action="{{ path('app_home') }}"> #}
                {#                            <input type="text" name="search" id="search" placeholder="Search for movies..."> #}
                {#                            <button type="submit">Search</button> #}
                {#                        </form> #}
            </li>
        </ul>
    </nav>
</header>
<main>
    {% block body %}{% endblock %}
</main>
<footer>
    <p>&copy; 2023 We Movies</p>
</footer>
{#<script type="application/javascript" src="{{ asset('js/search.js.twig') }}"></script>#}
<script>
    document.getElementById('search-input').addEventListener('input', function() {
        const query = this.value;
        const clearButton = document.getElementById('clear-search');
        if (query.length > 2) {
            fetch(`/search?query=${query}`)
                .then(response => response.json())
                .then(data => {
                    const results = document.getElementById('search-results');
                    results.innerHTML = '';
                    data.forEach(movie => {
                        const li = document.createElement('li');
                        li.textContent = movie.title;
                        li.dataset.movieId = movie.id;
                        li.addEventListener('click', function() {
                            fetch(`/movies/${this.dataset.movieId}`)
                                .then(response => response.json())
                                .then(movieDetails => {
                                    const modal = document.getElementById('movie-modal');
                                    const details = document.getElementById('movie-details');
                                    details.innerHTML = `
                                        <h2>${movieDetails.title}</h2>
                                        <img src="{{ image_url('${movieDetails.poster_path}') }}" alt="${movieDetails.title}">
                                        <p>${movieDetails.overview}</p>
                                    `;
                                    modal.style.display = 'block';
                                });
                        });
                        results.appendChild(li);
                    });
                });
            clearButton.style.display = 'inline';
        } else {
            clearButton.style.display = 'none';
        }
    });

    document.getElementById('clear-search').addEventListener('click', function() {
        const searchInput = document.getElementById('search-input');
        searchInput.value = '';
        document.getElementById('search-results').innerHTML = '';
        this.style.display = 'none';
    });
</script>
<script type="application/javascript" src="{{ asset('js/modal.js') }}"></script>
</body>
</html>
